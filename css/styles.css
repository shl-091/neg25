:root{
  /* Morandi palette (muted, low saturation) */
  --m-brown:#8B6B5B;     /* main brown */
  --m-brown-2:#B79A86;   /* lighter brown */
  --m-blue:#6E8CA0;      /* main blue */
  --m-blue-2:#A4B6C2;    /* lighter blue */
  --m-green:#9BAA97;
  --m-rose:#B8A1A6;
  --m-sand:#D2C3B5;
  --ink:#2b2b2b;
  --ink-soft:#444;
  --bg:#F3F1EE;
  --white:#fff;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
  color:var(--ink);
  background:var(--bg);
  overflow:hidden;
}

#app{position:relative; height:100vh; width:100vw}

/* language switch (moved to top-right) */
.lang-switch{
  position:fixed; top:16px; right:16px; z-index:6;
}
#lang-toggle{
  border:none; background:var(--white); color:var(--ink);
  padding:8px 12px; border-radius:999px; box-shadow:0 2px 8px rgba(0,0,0,.08);
  cursor:pointer; font-weight:600;
}
.lang-menu{
  position:absolute; top:44px; right:0; list-style:none; margin:0; padding:6px;
  background:var(--white); border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,.12);
  display:none; min-width:180px;
}
.lang-menu.show{display:block}
.lang-menu li{
  padding:8px 10px; border-radius:8px; cursor:pointer;
}
.lang-menu li:hover{background:rgba(0,0,0,.05)}

/* background blobs */
.bg{position:absolute; inset:0; overflow:hidden; z-index:0}
.blob{
  position:absolute; filter:blur(40px); opacity:.45; mix-blend-mode:multiply;
  border-radius:50%;
  animation:float 18s ease-in-out infinite alternate;
}
.b1{background:var(--m-blue-2); width:45vmax; height:45vmax; top:-10vmax; left:-10vmax}
.b2{background:var(--m-brown-2); width:40vmax; height:40vmax; bottom:-12vmax; right:-10vmax; animation-delay:1s}
.b3{background:var(--m-green); width:35vmax; height:35vmax; bottom:10vmax; left:15vmax; animation-delay:2s}
.grain{
  position:absolute; inset:-200px; pointer-events:none; background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="140" height="140" viewBox="0 0 140 140"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="2" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity="0.04"/></svg>');
}

@keyframes float{
  0%{transform:translate3d(0,0,0) scale(1)}
  100%{transform:translate3d(3vmax,-2vmax,0) scale(1.05)}
}

/* screens */
.screen{
  position:absolute; inset:0; display:none; z-index:1;
  padding:clamp(16px, 3vw, 32px);
}
.screen.active{display:block; animation:fadeIn .4s ease both}
@keyframes fadeIn{from{opacity:0; transform:translate3d(0,6px,0)} to{opacity:1; transform:none}}

/* landing screen */
.center-stack{
  position:absolute; inset:0;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  text-align:center; gap:16px; z-index:2;
}
.logo{width:96px; height:96px; opacity:.9}
.brand{font-size:clamp(28px, 6vw, 64px); letter-spacing:1px; margin:0; color:var(--ink);}
.subtitle{margin:0; color:var(--ink-soft); opacity:.8}

/* step heads */
.step-head{
  display:flex; align-items:center; justify-content:space-between;
  padding:56px 8px 0 8px; /* extra top padding to avoid overlap with lang switch */
}
.step-head h2{margin:0; font-size:clamp(20px,3.5vw,28px)}
.step-progress{
  font-weight:700; color:var(--white); background:linear-gradient(135deg, var(--m-blue), var(--m-brown));
  padding:6px 12px; border-radius:999px; box-shadow:0 3px 14px rgba(0,0,0,.12);
}

/* word clouds container */
.cloud{position:absolute; inset:0; overflow:hidden;}

/* tags */
.tag{
  position:absolute; /* radial/ripple layout uses absolute positioning */
  display:flex; align-items:center; justify-content:center;
  border-radius:50%; background:var(--white); color:var(--ink);
  padding:16px; min-width:64px; min-height:64px; user-select:none;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
  transition:transform .2s ease, box-shadow .2s ease, background .2s ease, color .2s ease;
  cursor:pointer;
}
.tag[data-size="s"]{width:64px; height:64px; font-size:12px}
.tag[data-size="m"]{width:88px; height:88px; font-size:13px}
.tag[data-size="l"]{width:110px; height:110px; font-size:15px; font-weight:600}
.tag:hover{transform:translateY(-3px) scale(1.02); box-shadow:0 14px 34px rgba(0,0,0,.14)}
.tag .dot{
  position:absolute; width:8px; height:8px; border-radius:50%;
  background:var(--m-rose); top:8px; right:10px; opacity:0; transition:opacity .2s;
}

/* footer actions */
.footer-actions{
  position:absolute; bottom:18px; right:18px; left:18px;
  display:flex; align-items:center; gap:12px;
}
.footer-actions .spacer{flex:1}
.back{
  border:2px solid rgba(0,0,0,.1); background:transparent; color:var(--ink);
  padding:10px 14px; border-radius:12px; font-weight:600; cursor:pointer;
}
.skip{
  border:none; background:transparent; color:var(--ink-soft); font-weight:600; cursor:pointer;
  padding:10px 14px; border-radius:12px;
}
.next{
  border:none; color:white; background:linear-gradient(135deg, var(--m-brown), var(--m-blue));
  padding:12px 18px; border-radius:14px; font-weight:700; cursor:pointer;
  box-shadow:0 10px 24px rgba(0,0,0,.16);
}

/* result */
#screen-result{display:none}
#screen-result.active{display:flex; align-items:center; justify-content:center}
.result-card{
  width:min(980px, 92vw); background:var(--white); border-radius:24px; padding:20px;
  box-shadow:0 30px 60px rgba(0,0,0,.18); display:grid; gap:18px;
  grid-template-columns: 1fr 1fr;
}
.result-visual{
  display:flex; align-items:center; justify-content:center; background:linear-gradient(135deg, var(--m-sand), var(--m-blue-2));
  border-radius:18px; min-height:280px; overflow:hidden;
}
.result-visual img{width:80%; height:auto}
.result-info{display:flex; flex-direction:column; gap:10px; justify-content:center}
.result-info h3{margin:0 0 8px 0; font-size:clamp(20px,3vw,28px)}
.result-actions{display:flex; gap:12px; flex-wrap:wrap}
.btn{
  border:none; padding:12px 16px; font-weight:700; border-radius:12px; cursor:pointer; text-decoration:none; display:inline-flex; align-items:center; justify-content:center;
}
.btn.primary{background:linear-gradient(135deg, var(--m-blue), var(--m-brown)); color:white}
.btn.ghost{background:transparent; border:2px solid rgba(0,0,0,.1); color:var(--ink)}

.pulse{animation:pulse 1.6s ease-in-out infinite}
@keyframes pulse{0%{transform:scale(1)} 50%{transform:scale(1.02)} 100%{transform:scale(1)}}

/* responsive */
@media (max-width: 820px){
  .result-card{grid-template-columns:1fr}
  .result-visual img{width:70%}
}

/* accessibility focus */
:focus-visible{outline: 3px solid var(--m-blue); outline-offset:3px}

/* hide back button on step1 */
#screen-step1 .back{visibility:hidden}

/* --- 强化选中态 & 汇聚动画用的幽灵标签 --- */
.tag.selected{
  background:linear-gradient(135deg, var(--m-blue-2), var(--m-sand));
  color:#1e1e1e;
  box-shadow:0 16px 40px rgba(0,0,0,.16);
  outline:2px solid rgba(0,0,0,.06);
}
.tag.selected .dot{opacity:1}

/* ghost clones that fly to center for recommendation */
.ghost-tag{
  position:fixed;
  z-index:50;
  border-radius:50%;
  padding:0;
  margin:0;
  display:flex; align-items:center; justify-content:center;
  background:inherit; color:inherit;
  box-shadow:0 12px 30px rgba(0,0,0,.18);
  pointer-events:none;
  transition: transform 700ms cubic-bezier(.2,.8,.2,1), opacity 500ms ease;
  will-change: transform, opacity;
}

/* 让词云层在头/脚层之上，但页脚的按钮仍然可点击 */
.cloud { z-index: 3; }

.step-head {
  z-index: 2;
  pointer-events: none;   /* 标题和进度不需要交互，让点击穿透 */
}

/* 页脚容器本身不拦截点击，只让按钮能点 */
.footer-actions {
  z-index: 4;
  pointer-events: none;
}
.footer-actions .back,
.footer-actions .skip,
.footer-actions .next {
  pointer-events: auto;   /* 恢复按钮点击 */
}
